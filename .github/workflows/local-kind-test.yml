name: local-kind-test

on:
  push:
    branches: [ main ]
  workflow_dispatch: {}

jobs:
  test-on-kind:
    runs-on:
      - self-hosted
      - Moshe-runner

    steps:
      - name: Checkout
        uses: actions/[email protected]

      - name: Show runner info
        run: |
          echo "Hostname: $(hostname)"
          echo "User: $(whoami)"

      - name: Check kind cluster
        run: |
          echo "Current context:"
          kubectl config current-context || echo "no current context"
          echo "Nodes:"
          kubectl get nodes || echo "kubectl get nodes failed"
          echo "All pods:"
          kubectl get pods -A || echo "kubectl get pods failed"

      # Example of where you'd actually deploy and test
      # - name: Deploy to kind
      #   run: |
      #     kubectl apply -f k8s/
      #     kubectl rollout status deployment/my-app --timeout=120s
      #
      # - name: Run integration tests
      #   run: ./scripts/run-tests.sh

